You are debugging and fixing an existing React.js + TypeScript map drawing application that uses OpenStreetMap and Turf.js.

CRITICAL ISSUES TO FIX (DO NOT IGNORE):

1) Polygon overlap constraints are NOT working correctly.
2) Polygon and LineString geometries are NOT being saved when drawing is completed via double-click.
3) Only Rectangle and Circle are currently being persisted.

YOUR TASK:
Fix the drawing completion logic and strictly enforce polygon overlap rules as described below.

------------------------------------
DRAWING COMPLETION FIX (MANDATORY):
------------------------------------
- Ensure that:
  - Polygon drawing is finalized and saved on DOUBLE-CLICK.
  - LineString drawing is finalized and saved on DOUBLE-CLICK.
- The drawn geometry must be:
  - Converted to valid GeoJSON
  - Added to application state
  - Rendered on the map
- Verify that draw-end / draw-stop events are properly handled for:
  - Polygon
  - LineString
- Do NOT rely only on Rectangle or Circle draw events.

------------------------------------
OVERLAP CONSTRAINT RULES (STRICT):
------------------------------------
Apply these rules ONLY to polygonal features:
- Polygon
- Rectangle
- Circle

Rules:
1) PARTIAL OVERLAP:
   - If a newly drawn polygonal feature partially overlaps with existing polygonal features,
   - Automatically trim the new geometry using Turf.js (difference operation),
   - Save ONLY the trimmed geometry.

2) FULL ENCLOSURE (BLOCKING CASE):
   - If the new polygon fully contains an existing polygon
   - OR if it is fully contained by an existing polygon,
   - BLOCK the draw operation completely,
   - Do NOT save the geometry,
   - Show a clear error message to the user.

3) LINESTRINGS:
   - LineString geometries must NOT be checked for overlap.
   - They must be saved exactly as drawn.
   - They can freely cross polygons or other LineStrings.

------------------------------------
IMPLEMENTATION REQUIREMENTS:
------------------------------------
- Use Turf.js functions such as:
  - booleanIntersects
  - booleanContains
  - booleanWithin
  - difference
- Ensure geometry validation after trimming.
- Add clear inline comments explaining:
  - Overlap detection
  - Auto-trimming logic
  - Blocking conditions
- Fix state updates so ALL geometry types are stored consistently.

------------------------------------
EXPECTED RESULT:
------------------------------------
- Polygon and LineString are saved correctly after double-click.
- Rectangle, Circle, Polygon never overlap after saving.
- Auto-trim works on partial overlap.
- Full enclosure is blocked with an error.
- LineString always saves and ignores overlap rules.

DO NOT rewrite the entire app.
ONLY fix and correct the broken logic and event handling.
